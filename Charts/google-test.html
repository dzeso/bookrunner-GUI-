<script type="text/x-template" id="chart-test-template">
 <div> 
  <chart-google-standart
     chartType="LineChart"
     :chartData="chartData"
     :chartConfig="chartOptions"
  />
  <chart-google-standart
     chartType="AreaChart"
     :chartData="chartData"
     :chartConfig="chartOptions1"
  />
</div> 
</script>

<script>
  var chartTest = {
    template: "#chart-test-template",
    
    props: {
        },
    
    components: {
       ChartGoogleStandart: ChartGoogleStandart,
       },

    mounted() {
      for (let coin in this.$store.getters.coinsOrder) {
        this.chartDataHeader[this.$store.getters.coinsOrder[coin]] = coin;
        this.chartDataLastValue[this.$store.getters.coinsOrder[coin]] = 0;
      };  
//      console.log("this.chartDataHeader", this.chartDataHeader);
      const lastColimnNumber = this.chartDataCache[0].length - 1;
      this.chartDataCache[0] = this.chartDataHeader;
//      console.log("this.chartDataCache", this.chartDataCache);
      for (let i=1; i<=this.chartDataDepth; i++) { 
        this.chartDataCache[i]=[];
        this.chartDataCache[i][0]="";
        this.chartDataCache[i][lastColimnNumber]=undefined;
        }
//      console.log("this.chartDataCache", this.chartDataCache);
      },
      
    computed: {
      chartData () {  
//        console.log("this.hstIndexData", this.hstIndexData);
        console.log("Индексы chartDataCacheIndex и hstIndexData.length", this.chartDataCacheIndex, this.hstIndexData.length);
        const lastColimnNumber = this.chartDataHeader.length-1;
        while (this.hstIndexData.length > this.chartDataCacheIndex) {
          let dataRow = [];
          let currentValue = 0;
          this.chartDataCache.shift();
          dataRow[0] = getDataFromISODate({data: this.hstIndexData[ this.chartDataCacheIndex ][0], mode: "hh:mm:ss"}); // вставляем дату
          for (let i=1; i<=lastColimnNumber; i++) { // вставляем нормализованные значения
            currentValue = this.hstIndexData[ this.chartDataCacheIndex ][i];
            if (currentValue) {
              if (!this.chartDataNormalizeBase[i]) {
                this.chartDataNormalizeBase[i] = currentValue; // фиксируем базу нормализации если ее еще нет
                }
              dataRow [i] = {
                f: currentValue,
                v: (currentValue/this.chartDataNormalizeBase[i] - 1)*1000,
                }
              this.chartDataLastValue [i] = dataRow [i];
              }
            else {
              dataRow [i] = this.chartDataLastValue [i];
            }
//            console.log("Нормализов, ", dataRow [i], this.chartDataLastValue [i]);
            }
          this.chartDataCache.push(dataRow);
          this.chartDataCacheIndex++;
        };
        this.chartDataCache[0] = this.chartDataHeader;
//        console.log("this.chartDataCache", this.chartDataCache);
        return this.chartDataCache;
        },
        
      hstIndexData () {  
//        console.log("dom-chart hstInstrumentTradeData", this.$store.getters.hstInstrumentTradeData[this.nmInstrument] || []);
        return this.$store.getters.okexData.index.array || [];
        },
      },
    methods: {
      },
    data () {
      return {    
        chartDataCache: [],
        chartDataCacheIndex: 0,
        chartDataNormalizeBase: [],
        chartDataNormalizeDelta: [],
        chartDataLastValue: [],
        chartDataHeader: ["time"],
        chartDataDepth: 60,

        chartOptions: { 
          height: 400,
          curveType: 'none',
          vAxisLogscale: true,
          vAxisScaleType: "mirrorLog",
          interpolateNulls: true,
          },
        chartOptions1: { 
          height: 400,
          curveType: 'none',
          vAxisLogscale: false,
          interpolateNulls: true,
          },
       }  
    }
  };
console.log ("chart-test started");
</script>
